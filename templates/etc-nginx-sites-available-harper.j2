# Server paramaters alphabetized for ease of reference.  
server {
    
    # Log all access attempts to harper
    access_log /var/log/nginx/harper-access.log;

    # Deny any connection attempt expect those specifically allowed below.
    deny all;

    # Log all nginx errors generated by harper
    error_log /var/log/nginx/harper-error.log;

    {% if deployment_environment == 'production' %}
    # This file will include all the IP addresses to allow
    include /etc/nginx/api-allow.conf;
    {% endif %}

    # harper runs on port 80
    listen 80;        

    # Configuration of the root location of the harper server.
    location / {
        include uwsgi_params;
        uwsgi_param UWSGI_SCHEME $scheme;
        uwsgi_param SERVER_SOFTWARE nginx/$nginx_version;
        uwsgi_pass unix:///tmp/harper-uwsgi.sock;
    }

    # Location of static assets
    location /static {
        root /var/www/harper/public_html/;
        index  index.html index.htm;
    }

    # Name of the endpoint that harper will answer on.
    {% if deployment_environment == 'local' %}
    server_name localharper.andrewharper.com;
    {% elif deployment_environment == 'production' %}
    server_name harper.andrewharper.com;
    {% endif %}

}